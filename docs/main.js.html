<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>main.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Card.html">Card</a><ul class='methods'><li data-type='method'><a href="Card.html#.create">create</a></li><li data-type='method'><a href="Card.html#.createConcept">createConcept</a></li></ul></li><li><a href="Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="Modal.html#hide">hide</a></li><li data-type='method'><a href="Modal.html#setContent">setContent</a></li><li data-type='method'><a href="Modal.html#show">show</a></li></ul></li><li><a href="Player.html">Player</a><ul class='methods'><li data-type='method'><a href="Player.html#.create">create</a></li></ul></li><li><a href="PopupManager.html">PopupManager</a><ul class='methods'><li data-type='method'><a href="PopupManager.html#close">close</a></li><li data-type='method'><a href="PopupManager.html#open">open</a></li></ul></li><li><a href="Toast.html">Toast</a><ul class='methods'><li data-type='method'><a href="Toast.html#show">show</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-GameConstants.html">GameConstants</a></li><li><a href="module-LoginScreen.html">LoginScreen</a></li><li><a href="module-Main.html">Main</a></li></ul><h3>Namespaces</h3><ul><li><a href="GameState.html">GameState</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CONCEPTS_DATA">CONCEPTS_DATA</a></li><li><a href="global.html#CONCEPTS_DATA_1">CONCEPTS_DATA_1</a></li><li><a href="global.html#PHILOSOPHERS_DATA">PHILOSOPHERS_DATA</a></li><li><a href="global.html#POSTS_DATA">POSTS_DATA</a></li><li><a href="global.html#SCHOOLS">SCHOOLS</a></li><li><a href="global.html#STUDY_CONTENT_DATA">STUDY_CONTENT_DATA</a></li><li><a href="global.html#arenas">arenas</a></li><li><a href="global.html#handleLibraryScreenClick">handleLibraryScreenClick</a></li><li><a href="global.html#handlePhilosophersScreenClick">handlePhilosophersScreenClick</a></li><li><a href="global.html#handlePlayScreenClick">handlePlayScreenClick</a></li><li><a href="global.html#handleReelsScreenClick">handleReelsScreenClick</a></li><li><a href="global.html#handleSchoolMembersScreenClick">handleSchoolMembersScreenClick</a></li><li><a href="global.html#handleSchoolsScreenClick">handleSchoolsScreenClick</a></li><li><a href="global.html#handleSymposiumScreenClick">handleSymposiumScreenClick</a></li><li><a href="global.html#initLibraryScreen">initLibraryScreen</a></li><li><a href="global.html#initPhilosophersScreen">initPhilosophersScreen</a></li><li><a href="global.html#initPlayScreen">initPlayScreen</a></li><li><a href="global.html#initReelsScreen">initReelsScreen</a></li><li><a href="global.html#initSchoolMembersScreen">initSchoolMembersScreen</a></li><li><a href="global.html#initSchoolsScreen">initSchoolsScreen</a></li><li><a href="global.html#initSymposiumScreen">initSymposiumScreen</a></li><li><a href="global.html#preloadAdjacentImages">preloadAdjacentImages</a></li><li><a href="global.html#renderMembers">renderMembers</a></li><li><a href="global.html#renderPosts">renderPosts</a></li><li><a href="global.html#renderReels">renderReels</a></li><li><a href="global.html#setupImageObserver">setupImageObserver</a></li><li><a href="global.html#setupReelsObserver">setupReelsObserver</a></li><li><a href="global.html#showLikeAnimation">showLikeAnimation</a></li><li><a href="global.html#toggleLike">toggleLike</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">main.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Main application entry point.
 * Orchestrates screen loading, navigation, and global event handling.
 * @module Main
 */
import { initPlayScreen, handlePlayScreenClick } from './screens/play.js';
import { initLibraryScreen, handleLibraryScreenClick } from './screens/library.js';
import { initPhilosophersScreen, handlePhilosophersScreenClick } from './screens/philosophers.js';
import { initSchoolsScreen, handleSchoolsScreenClick } from './screens/schools.js';
import { initSymposiumScreen, handleSymposiumScreenClick } from './screens/symposium.js'; 
import { initSchoolMembersScreen, handleSchoolMembersScreenClick } from './screens/school_members.js'; 
import { initReelsScreen, handleReelsScreenClick } from './screens/reels.js';
import { toast } from './ui/Toast.js';
import { gameState } from './data/gameState.js';
import { popupManager } from './ui/PopupManager.js';

document.addEventListener('DOMContentLoaded', () => {
    // --- LOGIN CHECK (from your file) ---
    if (!localStorage.getItem('isLoggedIn')) {
        window.location.href = 'login.html';
        return;
    }

    // --- NEW: DOM ELEMENT SELECTION FOR MULTI-PANEL LAYOUT ---
    const gameScreen = document.querySelector('.game-screen');
    const contextPanel = document.getElementById('context-panel'); // Main panel on mobile, side panel on desktop
    const mainDebatePanel = document.getElementById('main-debate-panel'); // Fixed debate panel on desktop
    const mainNav = document.querySelector('.main-nav');
    const sidebarToggleButton = document.getElementById('sidebar-toggle-btn');
    const gameHeader = document.querySelector('.game-header');

    // --- NEW: STATE TRACKING FOR PANELS ---
    /**
     * Tracks the name of the screen currently displayed in the context panel (desktop only).
     * @type {string}
     */
    let currentContextScreenName = ''; // Tracks what's in the context panel
    const DESKTOP_BREAKPOINT = 768;

    // --- HELPER FUNCTIONS (from your file, unchanged) ---
    const formatTime = (s) => { if (s &lt;= 0) return "Pronto!"; const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60; return h > 0 ? `${h}H ${m}MIN` : m > 0 ? `${m}MIN ${sec}SEG` : `${sec}SEG`; };
    const getChestIcon = (t) => `fas ${{Papiro: 'fa-scroll', Tomo: 'fa-book', 'Obra Rara': 'fa-gem'}[t] || 'fa-box'}`;
    
    // --- NEW: HELPER TO CHECK VIEWPORT ---
    /**
     * Checks if the current viewport width corresponds to a desktop view.
     * @returns {boolean} True if viewport width >= DESKTOP_BREAKPOINT.
     */
    const isDesktopView = () => window.innerWidth >= DESKTOP_BREAKPOINT;

    // --- UI UPDATE FUNCTION (from your file, unchanged) ---
    /**
     * Updates the dynamic UI elements based on the current game state.
     * Updates resources (scrolls, books), stats (trophies, xp), and timers.
     */
    const updateDynamicUI = () => {
        const scrollAmount = document.getElementById('scroll-amount');
        if (scrollAmount) scrollAmount.innerText = gameState.scrolls;

        const bookAmount = document.getElementById('book-amount');
        if (bookAmount) bookAmount.innerText = gameState.books;

        const trophyCount = document.getElementById('trophy-count');
        if (trophyCount) trophyCount.innerText = gameState.trophies;

        const xpFill = document.getElementById('xp-fill');
        if (xpFill) xpFill.style.width = `${(gameState.xp / gameState.xpMax) * 100}%`;

        const xpText = document.getElementById('xp-text');
        if (xpText) xpText.innerText = `${gameState.xp}/${gameState.xpMax}`;
        
        // This function will find these elements regardless of which panel they are in
        const freeChestTimer = document.getElementById('free-chest-timer');
        if(freeChestTimer) freeChestTimer.innerText = gameState.timers.freeChest > 0 ? `Em: ${formatTime(gameState.timers.freeChest)}` : 'COLETAR!';
        const freeChest = document.getElementById('free-chest');
        if(freeChest) freeChest.classList.toggle('ready', gameState.timers.freeChest &lt;= 0);

        const crownChestTimer = document.getElementById('crown-chest-timer');
        if(crownChestTimer) crownChestTimer.innerText = gameState.timers.crownChest > 0 ? `Em: ${formatTime(gameState.timers.crownChest)}` : 'COLETAR!';
        const crownChest = document.getElementById('crown-chest');
        if(crownChest) crownChest.classList.toggle('ready', gameState.timers.crownChest &lt;= 0);

        const chestSlotsContainer = document.getElementById('chest-slots-container');
        if (chestSlotsContainer) {
            chestSlotsContainer.innerHTML = '';
            gameState.chestSlots.forEach((c, i) => {
                const s = document.createElement('div'); s.className = 'chest-slot'; s.dataset.index = i;
                if (c) {
                    s.innerHTML = `&lt;i class="${getChestIcon(c.type)} fa-2x">&lt;/i>&lt;span>${c.type}&lt;/span>&lt;span>${c.arena}&lt;/span>&lt;strong>${formatTime(c.remainingTime)}&lt;/strong>`;
                    s.classList.add(c.status);
                } else { s.innerHTML = `&lt;span>Vazio&lt;/span>`; }
                chestSlotsContainer.appendChild(s);
            });
        }
    };

    /**
     * --- NEW: REWORKED SCREEN LOADING LOGIC ---
     * This function now only loads content into a specific panel and runs initializers.
     * It's called by the main `loadScreen` function.
     */
    /**
     * Loads screen content into a specific DOM element and initializes it.
     * @async
     * @param {string} screenName - The name of the screen to load (e.g., 'play', 'library').
     * @param {HTMLElement} targetPanel - The DOM element where content should be injected.
     * @param {Object} [params=null] - Optional parameters to pass to the screen initializer.
     */
    const loadContentIntoPanel = async (screenName, targetPanel, params = null) => {
        try {
            // NOTE: Using your path '/views/'
            const response = await fetch(`views/${screenName}.html`);
            if (!response.ok) throw new Error(`Could not load screen: ${screenName}`);
            
            const content = await response.text();
            targetPanel.innerHTML = content;
            
            // On desktop, track the context screen name
            if(targetPanel === contextPanel) {
                currentContextScreenName = screenName;
            }

            // Run screen-specific initialization logic (from your file)
            switch (screenName) {
                case 'play': initPlayScreen(gameState, updateDynamicUI, toast); break;
                case 'library': initLibraryScreen(gameState, updateDynamicUI, toast); break;
                case 'philosophers': initPhilosophersScreen(gameState, updateDynamicUI, toast); break;
                case 'schools': initSchoolsScreen(gameState, updateDynamicUI, toast); break;
                case 'symposium': initSymposiumScreen(gameState, updateDynamicUI, toast); break;
                case 'school_members': initSchoolMembersScreen(params, gameState); break;
                case 'reels': initReelsScreen(gameState); break;
                default: console.warn(`No specific init function for screen: ${screenName}`);
            }

            updateDynamicUI();
        } catch (error) {
            console.error('Error loading screen content:', error);
            targetPanel.innerHTML = `&lt;p>Error loading content.&lt;/p>`;
        }
    };

    /**
     * --- NEW: MAIN SCREEN ORCHESTRATOR ---
     * This function decides WHERE to load content based on viewport size.
     */
    /**
     * Orchestrates screen loading based on the device type (mobile vs desktop).
     * On desktop, manages the split view (main debate panel vs context panel).
     * On mobile, loads content into the single main view.
     * @param {string} screenName - The name of the screen to navigate to.
     * @param {Object} [params=null] - Optional navigation parameters.
     */
    const loadScreen = (screenName, params = null) => {
        // Update active state on navigation
        const navItems = mainNav.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.classList.toggle('active', item.dataset.target === screenName);
        });

        if (isDesktopView()) {
            // DESKTOP LOGIC
            // The 'play' screen is fixed. Clicking it does nothing but set the active state.
            // Any other screen is loaded into the context panel.
            if (screenName !== 'play') {
                loadContentIntoPanel(screenName, contextPanel, params);
            }
        } else {
            // MOBILE LOGIC
            // All screens, including 'play', are loaded into the single main panel.
            loadContentIntoPanel(screenName, contextPanel, params);
        }
    };

    /**
     * --- NEW: SIDEBAR TOGGLE FUNCTIONALITY ---
     */
    const toggleSidebar = () => {
        gameScreen.classList.toggle('sidebar-collapsed');
        const isCollapsed = gameScreen.classList.contains('sidebar-collapsed');
        localStorage.setItem('sidebarState', isCollapsed ? 'collapsed' : 'expanded');
    };

    /**
     * --- INITIALIZATION FUNCTION ---
     */
    /**
     * Initializes the application.
     * Sets up sidebar state, loads initial screens, and attaches global event listeners.
     */
    const initialize = () => {
        // Setup sidebar state from localStorage
        if (isDesktopView() &amp;&amp; localStorage.getItem('sidebarState') !== 'expanded') {
            gameScreen.classList.add('sidebar-collapsed');
        }

        // Initial screen loading
        if (isDesktopView()) {
            // DESKTOP: Load 'play' into the main panel and 'philosophers' into the context panel
            loadContentIntoPanel('play', mainDebatePanel);
            loadScreen('philosophers'); // Use loadScreen to set active nav item correctly
        } else {
            // MOBILE: Load 'play' into the only panel
            loadScreen('play');
        }

        // --- EVENT LISTENERS ---

        // Navigation click handler
        mainNav.addEventListener('click', (e) => {
            const navItem = e.target.closest('.nav-item');
            if (navItem &amp;&amp; navItem.dataset.target) {
                e.preventDefault();
                loadScreen(navItem.dataset.target);
            }
        });

        // Sidebar toggle button listener
        if (sidebarToggleButton) {
            sidebarToggleButton.addEventListener('click', toggleSidebar);
        }

        // Header click listener (for popups)
        gameHeader.addEventListener('click', (e) => {
            if (e.target.closest('.xp-bar-container')) {
                popupManager.open('level-xp');
            }
        });

        // --- MODIFIED: GLOBAL CLICK DELEGATION ---
        gameScreen.addEventListener('click', (e) => {
            let navigationAction = null;

            if (isDesktopView()) {
                // DESKTOP: Check which panel was clicked
                if (e.target.closest('#context-panel')) {
                    // Click was in the context panel, use its specific handler
                    switch (currentContextScreenName) {
                        case 'library': handleLibraryScreenClick(e, gameState, updateDynamicUI, toast); break;
                        case 'schools': navigationAction = handleSchoolsScreenClick(e, gameState, updateDynamicUI, toast); break;
                        case 'symposium': handleSymposiumScreenClick(e, gameState, updateDynamicUI, toast); break;
                        case 'philosophers': handlePhilosophersScreenClick(e, gameState, updateDynamicUI, toast); break;
                        case 'school_members': handleSchoolMembersScreenClick(e, gameState, toast); break;
                        case 'reels': handleReelsScreenClick(e, gameState, toast); break;
                    }
                } else if (e.target.closest('#main-debate-panel')) {
                    // Click was in the fixed debate panel
                    handlePlayScreenClick(e, gameState, updateDynamicUI, toast);
                }
            } else {
                // MOBILE: The old logic works perfectly, as there's only one panel
                switch (currentContextScreenName) {
                    case 'play': handlePlayScreenClick(e, gameState, updateDynamicUI, toast); break;
                    case 'library': handleLibraryScreenClick(e, gameState, updateDynamicUI, toast); break;
                    case 'schools': navigationAction = handleSchoolsScreenClick(e, gameState, updateDynamicUI, toast); break;
                    case 'symposium': handleSymposiumScreenClick(e, gameState, updateDynamicUI, toast); break;
                    case 'philosophers': handlePhilosophersScreenClick(e, gameState, updateDynamicUI, toast); break;
                    case 'school_members': handleSchoolMembersScreenClick(e, gameState, toast); break;
                    case 'reels': handleReelsScreenClick(e, gameState, toast); break;
                }
            }

            // Handle navigation actions returned from click handlers
            if (navigationAction &amp;&amp; navigationAction.action === 'navigate') {
                loadScreen(navigationAction.screen, navigationAction.params);
            }
        });

        // --- GAME TIMER (from your file, unchanged) ---
        setInterval(() => {
            if (gameState.timers.freeChest > 0) gameState.timers.freeChest--;
            if (gameState.timers.crownChest > 0) gameState.timers.crownChest--;
            gameState.chestSlots.forEach(c => {
                if (c &amp;&amp; c.status === 'unlocking' &amp;&amp; c.remainingTime > 0) {
                    c.remainingTime--;
                    if (c.remainingTime === 0) {
                        c.status = 'ready';
                        gameState.isUnlocking = false;
                    }
                }
            });
            updateDynamicUI();
        }, 1000);
    };

    // --- START THE APPLICATION ---
    initialize();
});</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Nov 18 2025 21:20:50 GMT-0300 (Horário Padrão de Brasília) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>




    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button onclick="var m=document.getElementById('dl-menu'); m.style.display = m.style.display === 'none' ? 'block' : 'none'" 
                style="background: #444; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.5);">
            Download Options
        </button>
        <div id="dl-menu" style="display: none; position: absolute; bottom: 100%; right: 0; background: #333; border: 1px solid #555; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); min-width: 160px; margin-bottom: 10px; overflow: hidden;">
            <a href="#" onclick="window.print(); return false;" style="display: block; padding: 10px; color: #eee; text-decoration: none; border-bottom: 1px solid #444;">Save as PDF</a>
            <a href="documentation.md" download="LOGOS_Docs.md" style="display: block; padding: 10px; color: #eee; text-decoration: none; border-bottom: 1px solid #444;">Download Markdown</a>
            <a href="data.json" download="LOGOS_Data.json" style="display: block; padding: 10px; color: #eee; text-decoration: none;">Download JSON</a>
        </div>
    </div>
    </body>
</html>
